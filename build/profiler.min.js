(function(){"use strict";var start,typeOf=function(){for(var objectToString=Object.prototype.toString,class2type={},classNames=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],i=0,len=classNames.length;len>i;i++){var className=classNames[i];class2type["[object "+className+"]"]=className.toLowerCase()}return function(arg){return null===arg?"null":"object"==typeof arg||"function"==typeof arg?class2type[objectToString.call(arg)]||"object":typeof arg}}(),each=function(typeOf){var supportsForEach="forEach"in Array.prototype;return function(obj,fn,ctx){var type=typeOf(obj);if("array"===type)if(supportsForEach)obj.forEach(fn,ctx);else for(var i=0,len=obj.length;len>i;i++)fn.call(ctx,obj[i],i);else if("object"===type)for(var key in obj)fn.call(ctx,obj[key],key);else fn.call(ctx,obj)}}(typeOf),filter=function(each,typeOf){var supportsFilter="filter"in Array.prototype;return function(arg,fn,ctx){var result,type=typeOf(arg);return"array"===type?supportsFilter?result=arg.filter(fn,ctx):(result=[],each(arg,function(item,index){fn.call(ctx,item,index)&&result.push(item)},ctx)):"object"===type&&(result={},each(arg,function(item,key){fn.call(ctx,item,key)&&(result[key]=item)},ctx)),result}}(each,typeOf),on=function(doc){[].slice;var on,supportW3C="addEventListener"in doc;return supportW3C&&(on=function(elem,eventName,handler,capture){return elem.addEventListener(eventName,handler,capture||!1)}),on}(window.document),off=function(doc){var off,supportW3C="removeEventListener"in doc;return supportW3C&&(off=function(elem,eventName,handler){return elem.removeEventListener(eventName,handler)}),off}(window.document),http=function(){var win=window,createXhr=function(){if(win.XMLHttpRequest)return function(){return new win.XMLHttpRequest};var ActiveXObj=win.ActiveXObject;return function(){try{return new ActiveXObj("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObj("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObj("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObj("Msxml2.XMLHTTP")}catch(e){}return null}}(),sendRequest=function(params){var xhr=createXhr();return xhr.onload=function(){200===xhr.status&&params.success(xhr.response)},xhr.onerror=function(err){params.error(err)},xhr.open(params.method,params.url,!0),xhr.send(JSON.stringify(params.data)),xhr};return{post:function(url,data,success,error){return sendRequest({method:"post",url:url,data:data,success:function(response){success&&success.call(window,response)},error:function(err){error&&error(err)}})}}}(),supportsTiming="performance"in window&&"timing"in window.performance;start=supportsTiming&&window.performance.timing.navigationStart?window.performance.timing.navigationStart:window.__profiler__start__=window.__profiler__start__||(new Date).valueOf();var Record=function(name,tags){this.name=name,this.tags=tags,this.start=(new Date).valueOf()-start,this.completed=!1};Record.prototype={complete:function(){this.end=(new Date).valueOf()-start,this.duration=this.end-this.start,this.completed=!0},toString:function(){return this.name+" "+this.start+"-"+this.end+" ("+this.duration+")"}},function(each,filter,on,off,start,Record){var domReady,windowLoad,url,win=window,doc=win.document,EVT_DOM_READY="DOMContentLoaded",EVT_LOAD="load",records=[],calls={},index={},session=(new Date).valueOf()+(0|1e3*Math.random()),interval=30;win.profiler={clear:function(){records=getPending(),index=buildIndex()},count:function(name){calls[name]=calls[name]||0,calls[name]++},start:function(name,tags){var record=new Record(name,tags||["script"]);records.push(record),index[name]=index[name]||[],index[name].push(record)},stop:function(name){index[name].shift().complete()},end:function(){this.stop.apply(this,arguments)},report:function(){return{onready:domReady,calls:calls,records:getCompleted(),timing:getTiming(),onload:windowLoad}},reset:function(){records=[],index={},calls={}},send:function(){if(url){var report=this.report();report.session=session,http.post(url,report)}},setup:function(params){url=params.url||url,session=params.session||session,interval=params.interval||interval},startReporting:function(){sendReport()}};var buildIndex=function(){var index={};return each(records,function(record){var name=record.name;index[name]=index[name]||[],index[name].push(record)}),index},getCompleted=function(){return filter(records,function(record){return record.completed===!0})},getPending=function(){return filter(records,function(record){return record.completed===!1})},getTiming=function(){var timing=null;return supportsTiming&&(timing={},each(window.performance.timing,function(value,key){value>0&&(timing[key]=value-start)})),timing},onLoad=function(){off(win,EVT_LOAD,onLoad),windowLoad=(new Date).valueOf()-start},onDomReady=function(){off(doc,EVT_DOM_READY,onDomReady),domReady=(new Date).valueOf()-start};on(doc,EVT_DOM_READY,onDomReady),on(win,EVT_LOAD,onLoad);var sendReport=function(){setTimeout(function(){this.send(),this.clear(),sendReport()},1e3*interval)};try{delete window.__profiler__start__}catch(e){}}(each,filter,on,off,start,Record)})();